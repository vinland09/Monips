<!DOCTYPE html>
<html>
<head>
    <title>IP Monitoring Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        #app {
            max-width: 700px;
            margin: 50px auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            padding: 10px;
            margin: 5px 0;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        form {
            margin-top: 20px;
        }
        input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button {
            padding: 10px 15px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        #languageSwitcher {
            text-align: center;
            margin-bottom: 20px;
        }
        #languageSwitcher button {
            margin: 5px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="languageSwitcher">
            <button onclick="switchLanguage('pt')">PortuguÃªs</button>
            <button onclick="switchLanguage('en')">English</button>
        </div>
        <h1 id="title">IP Monitoring Dashboard</h1>
        <ul id="ipList"></ul>

        <canvas id="latencyChart" width="400" height="200"></canvas>

        <form id="addForm">
            <input type="text" id="addInput" placeholder="Add IP">
            <button type="submit" id="addButton">Add</button>
        </form>

        <form id="updateForm">
            <input type="text" id="oldIpInput" placeholder="IP to be modified">
            <input type="text" id="newIpInput" placeholder="New IP">
            <button type="submit" id="updateButton">Modify</button>
        </form>

        <form id="removeForm">
            <input type="text" id="removeInput" placeholder="Remove IP">
            <button type="submit" id="removeButton">Remove</button>
        </form>
    </div>

    <script>
        let currentLanguage = 'en'; // Default language: English

        const ipList = document.getElementById('ipList');
        const addForm = document.getElementById('addForm');
        const updateForm = document.getElementById('updateForm');
        const removeForm = document.getElementById('removeForm');
        const ctx = document.getElementById('latencyChart').getContext('2d');

        const latencyChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    label: 'Latency (ms)',
                    data: [],
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        const translations = {
            pt: {
                title: "Monitoramento de IP",
                addPlaceholder: "Adicionar IP",
                updatePlaceholderOld: "IP a ser alterado",
                updatePlaceholderNew: "Novo IP",
                removePlaceholder: "IP a remover",
                addButton: "Adicionar",
                updateButton: "Modificar",
                removeButton: "Remover"
            },
            en: {
                title: "IP Monitoring Dashboard",
                addPlaceholder: "Add IP",
                updatePlaceholderOld: "IP to be modified",
                updatePlaceholderNew: "New IP",
                removePlaceholder: "Remove IP",
                addButton: "Add",
                updateButton: "Modify",
                removeButton: "Remove"
            }
        };

        function switchLanguage(lang) {
            currentLanguage = lang;
            const translation = translations[lang];
            document.getElementById('title').textContent = translation.title;
            document.getElementById('addInput').placeholder = translation.addPlaceholder;
            document.getElementById('oldIpInput').placeholder = translation.updatePlaceholderOld;
            document.getElementById('newIpInput').placeholder = translation.updatePlaceholderNew;
            document.getElementById('removeInput').placeholder = translation.removePlaceholder;
            document.getElementById('addButton').textContent = translation.addButton;
            document.getElementById('updateButton').textContent = translation.updateButton;
            document.getElementById('removeButton').textContent = translation.removeButton;
            fetchIPs(); // Refresh data with selected language
        }

        async function fetchIPs() {
            const response = await fetch(`/status?lang=${currentLanguage}`);
            const data = await response.json();

            ipList.innerHTML = '';
            const labels = [];
            const latencies = [];
            for (const [ip, details] of Object.entries(data)) {
                const item = document.createElement('li');
                item.textContent = `${ip}: ${details.status} - Latency: ${details.latency}`;
                ipList.appendChild(item);

                labels.push(ip);
                latencies.push(details.latency === "N/A" ? 0 : details.latency);
            }

            latencyChart.data.labels = labels;
            latencyChart.data.datasets[0].data = latencies;
            latencyChart.update();
        }

        async function updateIPs(payload) {
            await fetch('/update_ips', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
            });
            fetchIPs();
        }

        addForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const ip = document.getElementById('addInput').value.trim();
            if (ip) {
                updateIPs({ add: ip });
                document.getElementById('addInput').value = '';
            }
        });

        updateForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const oldIp = document.getElementById('oldIpInput').value.trim();
            const newIp = document.getElementById('newIpInput').value.trim();
            if (oldIp && newIp) {
                updateIPs({ remove: oldIp, add: newIp });
                document.getElementById('oldIpInput').value = '';
                document.getElementById('newIpInput').value = '';
            }
        });

        removeForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const ip = document.getElementById('removeInput').value.trim();
            if (ip) {
                updateIPs({ remove: ip });
                document.getElementById('removeInput').value = '';
            }
        });

        fetchIPs();
        setInterval(fetchIPs, 300); // Updates every 30 seconds
    </script>
</body>
</html>
